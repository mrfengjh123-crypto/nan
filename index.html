<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>2026 快乐</title>
<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:#000;
    font-family:-apple-system,BlinkMacSystemFont;
}
canvas{
    position:fixed;
    inset:0;
    z-index:10;
}
#start-overlay{
    position:fixed;
    inset:0;
    background:#000;
    z-index:2000;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#ff69b4;
    letter-spacing:4px;
    font-size:18px;
    cursor:pointer;
}
</style>
</head>
<body>

<div id="start-overlay">✨ 点击开启 2026 的惊喜 ✨</div>
<audio id="bgm" loop><source src="music.mp3" type="audio/mpeg"></audio>

<script src="https://cdn.staticfile.org/three.js/r128/three.min.js"></script>
<script>
/* ================= 基础配置（手机适配） ================= */
const isMobile = /Mobi|Android/i.test(navigator.userAgent);
const TREE_POINTS = isMobile ? 26000 : 50000;
const HEART_POINTS = isMobile ? 3000 : 6000;
const TREE_HEIGHT = 12.0;
const LOOPS = 9;

/* ================= Three.js 初始化 ================= */
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(
    65,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
);
camera.position.set(0, 2.2, 13);

let renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

let group = new THREE.Group();
scene.add(group);

/* ================= tree.py → 圣诞树点云 ================= */
function genTree(){
    const pos = new Float32Array(TREE_POINTS * 3);
    const col = new Float32Array(TREE_POINTS * 3);

    let i = 0;
    for(let n=0;n<TREE_POINTS;n++){
        const u = Math.random();
        const h = Math.pow(u, 1.6);
        const y = TREE_HEIGHT * h;

        let baseR = Math.pow(1-h,1.1) * 3.2;
        const wave = Math.max(0, Math.sin((h*5.8+0.15)*Math.PI*2));
        baseR *= 1 + 0.65 * wave;

        const angle = u * LOOPS * Math.PI * 2;
        const r = baseR * (0.85 + Math.random()*0.23);

        const x = Math.cos(angle) * r;
        const z = Math.sin(angle) * r;

        pos[i*3]   = x;
        pos[i*3+1] = y;
        pos[i*3+2] = z;

        let mid = Math.max(0.15, 1 - Math.abs(h-0.55)*1.5);
        col[i*3]   = 1.0;
        col[i*3+1] = (155 + 90*mid)/255;
        col[i*3+2] = (185 + 70*mid)/255;

        i++;
    }

    const geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.BufferAttribute(pos,3));
    geo.setAttribute('color', new THREE.BufferAttribute(col,3));

    const mat = new THREE.PointsMaterial({
        size: isMobile ? 0.045 : 0.04,
        vertexColors:true,
        transparent:true,
        blending:THREE.AdditiveBlending,
        depthWrite:false
    });

    group.add(new THREE.Points(geo,mat));
}

/* ================= tree.py → 树顶爱心 ================= */
function genHeart(){
    const pos = [];
    const col = [];

    while(pos.length/3 < HEART_POINTS){
        const x = THREE.MathUtils.randFloat(-1.3,1.3);
        const y = THREE.MathUtils.randFloat(-1.4,1.4);

        const f = Math.pow(x*x+y*y-1,3) - x*x*y*y*y;
        if(f<=0){
            const wx = x*0.7;
            const wy = TREE_HEIGHT + (y+1)*0.5;
            const wz = THREE.MathUtils.randFloat(-0.18,0.18);

            pos.push(wx,wy,wz);

            const d = Math.hypot(x,y);
            const k = Math.max(0.35,1.15-0.5*d);
            col.push(
                1.0,
                (130*k+80)/255,
                (190*k+70)/255
            );
        }
    }

    const geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos,3));
    geo.setAttribute('color', new THREE.Float32BufferAttribute(col,3));

    const mat = new THREE.PointsMaterial({
        size: isMobile ? 0.06 : 0.05,
        vertexColors:true,
        transparent:true,
        blending:THREE.AdditiveBlending,
        depthWrite:false
    });

    const heart = new THREE.Points(geo,mat);
    group.add(heart);
}

/* ================= 启动 & 动画 ================= */
genTree();
genHeart();

let started = false;
function animate(){
    requestAnimationFrame(animate);
    if(started){
        group.rotation.y += 0.0045;
        const s = 1 + Math.sin(Date.now()*0.004)*0.04;
        group.children[1].scale.set(s,s,s);
    }
    renderer.render(scene,camera);
}
animate();

/* ================= 交互 ================= */
document.getElementById('start-overlay').onclick = ()=>{
    started = true;
    document.getElementById('bgm').play();
    document.getElementById('start-overlay').style.display='none';
};

window.onresize = ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
};
</script>
</body>
</html>
